<!DOCTYPE html>
<html>

    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src='https://d3js.org/d3.v5.js'></script>
  <body onload="init()">
    <style>

      #OverallCountryMedalStats{
            delay : 1000;

      }
      div.tooltip {
        color: #222;
        background: #fff;
        padding: .5em;
        text-shadow: #f5f5f5 0 1px 0;
        border-radius: 2px;
        box-shadow: 0px 0px 2px 0px #a6a6a6;
        opacity: 0.9;
        position: absolute;
      }
        body {
          font: 10px sans-serif;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .line {
          fill: none;
          stroke: steelblue;
          stroke-width: 2px;
        }

      .multiLineChart {
          width: 100%;
          height: 100%;
          position: absolute;
        }



    </style>

  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <h1 align=center> Medal Based Analysis </h1>

  <h2 align=center font-style="Comic-sans">With identified top 15 Countries, below is their medal distribution
  </h2>


<p> This Visualization below gives Olympics medal based distribution on the top 15 countries. </p>
<div id="OverallMedalDistributionOverOlympics">
</div>
<br>
<br>
<br>
<br>
<div id="CountryBasedMedalDistribution">
  <h2> Country Based Medal Analysis </h2>
  <!-- Initialize a select button -->
  <select id="selectCountry"></select>

  <div id="OverallCountryMedalStats">
    <svg width="1200" height="400" class="Medal">
    </svg>
  </div>


</div>
<!--h2 align=center font-style="Comic-sans"> Dig deep into each country </h2-->

<script type="text/javascript">
  function init () {
    var showMultiline = countryMedalDistributionLineChart();
    //document.getElementId("OverallCountryMedalStats")delay(1000).fadeIn(1000);
   }


  async function countryMedalDistributionLineChart() {
    // Define margins
   var margin = { top: 20, right: 80, bottom: 30, left: 50 },
       width = 1800 - margin.left - margin.right,
       height = 400 - margin.top - margin.bottom;

   // Define date parser
   var parseDate = d3.timeParse("%Y-%m-%d %H:%M:%S");

   // Define scales
   var xScale = d3.scaleLinear().range([0, width]);
   var yScale = d3.scaleLinear().range([height, 0]);
   var color = d3.scaleOrdinal().range(d3.schemeCategory10);

   // Define axes
   var xAxis = d3.axisBottom().scale(xScale);
   var yAxis = d3.axisLeft().scale(yScale);

   // Define lines
   var line = d3
     .line()
     .curve(d3.curveMonotoneX)
     .x(function(d) {
       return xScale(d["Year"]);
     })
     .y(function(d) {
       return yScale(d["medalsWon"]);
     });
   // Define svg canvas
   var svg =  d3.selectAll("#OverallMedalDistributionOverOlympics")
                     .append("svg").attr("id","multiLineChart")
                     .attr("width", width + margin.left + margin.right)
                     .attr("height", height + margin.top + margin.bottom)
                     .append("g")
                     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              // Read in data
   const TotalMedalDistributionByCountry = await d3.csv("https://raw.githubusercontent.com/Trupthi-developer/NarrativeVisualization/master/MedalDistributionOverYearByCountry.csv");

   //Get the color ranges
   var categoryByName = d3.keys(TotalMedalDistributionByCountry[0]).filter(function(key) {
       return key !== "Year";
     });


   color.domain(categoryByName);

   year1900To1932 = [1900,1904,1906,1912,1920,1924,1928,1932];
   year1936To1972 = [1936,1948,1952,1956,1960,1964,1968,1972];
   year1976To1998 = [1976,1980,1984,1984,1988,1992,1994,1996,1998];
   year2000To2016 = [2000,2002,2004,2006,2008,2010,2012,2014,2016];

   var dataFrom1900To1932 = TotalMedalDistributionByCountry.filter(function(d){ return year1900To1932.indexOf(+d.Year) >= 0 });
   var dataFrom1936To1972 = TotalMedalDistributionByCountry.filter(function(d){ return year1976To1998.indexOf(+d.Year) >= 0 });
   var dataFrom1976To1998 = TotalMedalDistributionByCountry.filter(function(d){ return year1976To1998.indexOf(+d.Year) >= 0  });
   var dataFrom2000To2016 = TotalMedalDistributionByCountry.filter(function(d){ return year2000To2016.indexOf(+d.Year) >= 0  });

  //Build Multiline Chart
          { // Set the color domain equal to the coutnries

              var concentrations= categoryByName.map(function(category) {
                            return {
                              category: category,
                              datapoints: TotalMedalDistributionByCountry.map(function(d) {
                              //dataFrom2000To2016.map(function(d) {
                                return { Year: d["Year"], medalsWon: +d[category] };
                              })
                            };
                          });
              // Set the domain of the axes
              xScale.domain([1900,2016]);
                //d3.extent(TotalMedalDistributionByCountry, function(d) {  return +d.Year;}));

              yScale.domain([0, 400])
              // Place the axes on the chart


              svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

              svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("class", "label")
                .attr("y", 6)
                .attr("dy", ".71em")
                .attr("dx", ".71em")
                .style("text-anchor", "beginning")
                .text("Total TotalMedalDistributionByCountry");


            svg.selectAll("#multiLineChart")
                  .enter()
                  .append("g")
                  .attr("fill", "none")
                  .attr("stroke", "steelblue")
                  .attr("stroke-width", 1.5)
                  .attr("stroke-linejoin", "round")
                  .attr("stroke-linecap", "round")
                  .attr("class", "category")
                  .data(concentrations)
                    .enter()
                    .append("path")
                    .attr("class", "line")
                    .attr("d", function(d) { return line(d.datapoints);
                      })
                      .style("stroke", function(d) {
                        return color(d.category);
                      })


            }

            // Define responsive behavior
            function resize() {
              var width =
                   parseInt(d3.select("#multiLineChart").style("width")) - margin.left - margin.right,
                height =
                  parseInt(d3.select("#multiLineChart").style("height")) - margin.top - margin.bottom;

              // Update the range of the scale with new width/height
              xScale.range([0, width]);
              yScale.range([height, 0]);

             // Place the axes on the chart

              // Update the axis and text with the new scale
              svg.select(".x.axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

              svg.select(".y.axis").call(yAxis);

              // Force D3 to recalculate and update the line
              svg.selectAll(".line").attr("d", function(d) {
                return line(d.datapoints);
              });

              // Update the tick marks
              xAxis.ticks(Math.max(width / 75, 2));
              yAxis.ticks(Math.max(height / 50, 2));
            }

            // Call the resize function whenever a resize event occurs
            d3.select(window).on("resize", resize);
              resize();
}
</script>

<script type="text/javascript">
var countryList = ["Australia","Canada","China","France","Germany","Great Britain","Hungary","Italy","Japan","Netherlands","Poland","Russia","Spain","Sweden","United States"];
var CountryDropDown = d3.select("#selectCountry")
                      .selectAll("myoptions")
                      .data(countryList)
                      .enter()
                      .append('option')
                      .attr("pointer-events", "none")
                      .text(function (d) { return d; }) // text showed in the menu
                      .attr("value", function (d) { return d; }) // corresponding value returned by the button
// Handler for dropdown value change
 var dropdownChange = function() {
    var Country = d3.select(this).property('value');
    console.log(Country);
    dashboard(Country)
    //plotEventByYear(newYear);
  };

  var CountryValue = d3.select("#selectCountry")
                  .on("change",dropdownChange );

</script>

<script>
  async function dashboard(CountryValue){
        const TotalMedalDistributionByCountry = await d3.csv("https://raw.githubusercontent.com/Trupthi-developer/NarrativeVisualization/assignmentUIUC/Top15CountriesMedalDistributionOverYear.csv");
        const Top3SportMedalDistributionByCountry = await d3.csv("https://raw.githubusercontent.com/Trupthi-developer/NarrativeVisualization/assignmentUIUC/Top3SportByCountryMedalDistribution.csv");
        const Top3SportGenderMedalDistributionByCountry = await d3.csv("https://raw.githubusercontent.com/Trupthi-developer/NarrativeVisualization/assignmentUIUC/Top3SportByCountryGenderMedalDistribution.csv");
    console.log(TotalMedalDistributionByCountry)
  }

</script>
</body>
</html>
